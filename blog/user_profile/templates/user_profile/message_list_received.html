{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "received messages" %} | {{ block.super }}{% endblock title %}

{% block content %}
<h1>{% trans "received messages" %}</h1>
<p><a class="button" href="{% url "message_create" %}">{% trans "create a new message"|capfirst %}</a></p>
<div class="toolbar">
  <form method="get" action="{{ request.path }}">
    <strong>{% trans "search by: "|capfirst %}</strong>
    <select name="sender" onchange="this.form.submit();">
      <option value="">{% trans "username"|capfirst %}</option>
      {% for user in user_list %}
        <option value="{{ user.username }}" {% if user.username == request.GET.receiver %}selected{% endif %}>
          ({{ user.username }})
        </option>
      {% endfor %}
    </select>
  </form>
</div>
{% if no_matches %}
  <p></p>
  <p>{% trans "no matches found." %}</p>
{% else %}
<div class="message-list">
  {% for message in message_list_received|dictsortreversed:"timestamp" %}
    {% with sender=message.sender %}
      <div class="message-room">
        <div class="message-sender">
          {% if sender.profile.picture %}
            <img src="{{ sender.profile.picture.url }}" alt="{% trans "profile picture"|title %}" class="profile-picture">
          {% else %}
          <div class="no-picture-placeholder" style="border-radius: 50%; width: 50px; height: 50px; background-color: white;"></div>
            {% endif %}
          <a href="{% url 'user_detail' sender.username %}">
            <strong>{{ sender }}</strong>
          </a>
        </div>
        <div class="message-content">
          <a class="message-text"> {{ message.text }}</a>
          {% if message.image %}
            <img src="{{ message.image.url }}" alt="{% trans "message image"|title %}" class="message-image">
          {% endif %}
        </div>
        <script>
          document.addEventListener('DOMContentLoaded', function() {
            var images = document.querySelectorAll('.message-image'); // Pasirenkame visus elementus su klase "message-image"
        
            images.forEach(function(image) {
              image.addEventListener('click', function() {
                this.classList.toggle('enlarged'); // Pridedame arba pašaliname klasę "enlarged" paspaudus ant nuotraukos
              });
            });
          });
        </script>
        <div class="message-details">
          <p> {{ message.timestamp }}</p>
        </div>
      </div>
    {% endwith %} 
  {% endfor %}
</div>
{% endif %}
{% endblock content %}